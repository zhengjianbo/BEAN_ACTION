 noError() 
string str = ""

//�Ż�
Array arr = create(100,1)

bool isExit(Array a,string s,int index)
{

    int i
    for(i = 0;i<index;++i)
    {
        string element = get(a,i,0)
        if(element == null)
            continue
        if(element == s)
        {
            return true
            break
        }

    }
    if(i == index)
        return false

}



//����1����ɵ�һ��Ŀ¼��������Skip

Item p
string key
int index = 0
Skip map = create   //����һ��Skip������ظ�

void FindFirstFolder(Item f){
 

    if(type f == "Project" || type f == "Folder")
    {

 
        string pathName = fullName(f)
	 
        if(isExit(arr,pathName,index))
            return

		 
            put(arr,pathName,index,0)
            index = index+1
  
        key = uniqueID(f)
	 
        put(map,key,f)

    }
}


for p in folder "/" do { 
   FindFirstFolder item(fullName p)
}


//����2���ӵ�һ��Ŀ¼��ʼ���±���
void scanFromFirstFolder(Folder f)
{

    Item itm

    for itm in f do
    {

        if (null itm) continue
        if (isDeleted(itm)) continue

        if ((type (itm) == "Project") || (type (itm) == "Folder"))
        {   

            string s = name(folder(itm))
 
			  string PathName = fullName(itm) 
			  
            str = str "<folder name=\""s "\"  type=\""type(itm)"\" path=\""PathName "\" >\n"

            scanFromFirstFolder(folder(itm))    //��һ��Ŀ¼��ʼ�ݹ����


            str = str "</folder>\n"

        }
        else if(type (itm) == "Formal")
        {
            string s = name(itm)
			
			string PathName = fullName(itm)
            str = str "<module name=\""s "\"  type=\"FomalModule\" path=\""PathName "\" /> "
         

           // str = str PathName "</module>\n"


        }

    }
}


//���ú���2��������еı���

str = str "<?xml version=\"1.0\" encoding=\"GB2312\" standalone=\"yes\" ?>\n" "<root>\n"

Folder ans
//��Skip��ȡ������һ��Ŀ¼
for ans in map do 
{
    string sFolder = name(ans)
    string typeName = type(ans)
string PathName = fullName(ans)
    str = str "<folder name=\""sFolder "\"  type=\""typeName"\" path=\""PathName "\">\n"

    scanFromFirstFolder(ans)

    str = str "</folder>\n"

}

str = str "</root>\n"
 
string errmsg=lastError()
if(errmsg!=null){ 
		 
}else{ 
		exportDir = "#EXPORT_DIR#" 
		exportXML = "#EXPORT_XML#"
 
		Stream outfile = write(exportDir exportXML ) 
						  outfile <<   str
		close outfile   
		
		errmsg=lastError()
}
 
 
